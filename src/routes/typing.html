<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Typing Lesson Game</title>
  <meta name="description" content="Typing Lesson Game" />
  <link rel="stylesheet" href="/style.css">
  <style>
    /* Basic styling for the game */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    #typing-game {
      margin: 20px auto;
      max-width: 800px;
      padding: 20px;
      border: 2px solid #ccc;
      border-radius: 8px;
      background-color: #f9f9f9;
    }
    #controls label {
      margin-right: 20px;
      font-size: 1.1em;
    }
    #instructions {
      margin: 10px 0;
      font-style: italic;
    }
    /* Game container layout */
    #game-container h2 {
      margin: 10px 0 5px;
      font-size: 1.3em;
    }
    #game-container > div {
      margin-bottom: 15px;
    }
    #example-text,
    #typed-text,
    #next-text {
      font-size: 1.5em;
      padding: 8px;
      border: 1px solid #aaa;
      border-radius: 4px;
      background: #fff;
      white-space: nowrap;
      overflow-x: auto;
    }
    /* Fix typed text container size when empty */
    #typed-text {
      min-height: 2.5em;
    }
    /* Status styling */
    #status p {
      margin: 5px 0;
    }
    /* Shortcut Information styling as a list */
    #shortcut-info ul {
      list-style-type: disc;
      padding-left: 20px;
    }
    #shortcut-info li {
      margin: 5px 0;
      font-size: 0.95em;
    }
    /* Colored text */
    #typed-text span.correct {
      color: green;
    }
    #typed-text span.incorrect {
      color: red;
    }
    /* Dark mode styling using prefers-color-scheme */
    @media (prefers-color-scheme: dark) {
      body {
        background-color: #121212;
        color: #e0e0e0;
      }
      #typing-game {
        border-color: #444;
        background-color: #1e1e1e;
      }
      #example-text,
      #typed-text,
      #next-text {
        border-color: #666;
        background-color: #2e2e2e;
      }
    }
  </style>
</head>
<body>
  <header>
    <nav class="navbar">
      <a href="/" class="logo" aria-label="sxclij">sxclij.com</a>
    </nav>
  </header>

  <main>

    <section id="typing-game">
      <!-- Mode selection controls -->
      <div id="controls">
        <label>
          <input type="radio" name="mode" value="raw" checked>
          Raw Mode
        </label>
        <label>
          <input type="radio" name="mode" value="shortcut">
          Shortcut Mode
        </label>
      </div>
      <!-- Instructions -->
      <div id="instructions">
        <p id="mode-instructions">
          In Raw Mode, type anywhere to start. Press Escape to switch to Shortcut Mode.
        </p>
      </div>
      <!-- Game container with ordered sections -->
      <div id="game-container">
        <div id="example-text"></div>
        <div id="typed-text"></div>
        <div id="next-text"></div>
        
        <h2>Status</h2>
        <div id="status">
          <p>Mode: <span id="current-mode">Raw</span></p>
          <p>Game Status: <span id="game-status">Waiting to start</span></p>
          <p>Errors: <span id="error-count">0</span></p>
          <p>Speed (CPM): <span id="speed">0</span></p>
          <p>Error Percent: <span id="error-percent">0</span>%</p>
          <p>Total Typed: <span id="total-typed">0</span></p>
          <p>Time: <span id="elapsed-time">0</span>s</p>
        </div>
        
        <h2>Shortcut Information</h2>
        <div id="shortcut-info">
          <ul>
            <li>In Raw Mode, type anywhere to start. Press Escape to switch to Shortcut Mode.</li>
            <li>In Shortcut Mode, press Enter to start, S to switch to Raw Mode, and R to reset the game.</li>
          </ul>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <p>Â© 2024 sxclij. All Rights Reserved.</p>
  </footer>

  <script>
    // Improved Typing Lesson Game Script
    (function() {
      // Get elements for mode and instructions
      const currentModeElement = document.getElementById('current-mode');
      const gameStatusElement = document.getElementById('game-status');
      const errorCountElement = document.getElementById('error-count');
      const speedElement = document.getElementById('speed');
      const errorPercentElement = document.getElementById('error-percent');
      const totalTypedElement = document.getElementById('total-typed');
      const elapsedTimeElement = document.getElementById('elapsed-time');
      const instructionsElement = document.getElementById('mode-instructions');
      const modeRadios = document.getElementsByName('mode');
      
      // Get elements for the game container sections
      const exampleTextElement = document.getElementById('example-text');
      const typedTextElement = document.getElementById('typed-text');
      const nextTextElement = document.getElementById('next-text');
      
      // Game variables
      let mode = 'raw';  // default mode is raw
      let gameStarted = false;
      let startTime = null;
      let clockInterval = null;
      
      // Array of text lines for typing practice (each ~8 words)
      const textLines = [
        "Pack my box with five dozen liquor jugs.",
        "The five boxing wizards jump quickly every day.",
        "Sphinx of black quartz, judge my vow now.",
        "Crazy Fredrick bought many very exquisite opal jewels.",
        "Just quickly pack five boxes with rich jam.",
        "My job requires extremely swift and steady typing."
      ];
      
      let currentLineIndex = 0;
      let currentCharIndex = 0;
      let totalTyped = 0;
      let errorCount = 0;
      
      // Update the Example and Next text areas.
      function updateExampleText() {
        if (currentLineIndex < textLines.length) {
          exampleTextElement.textContent = textLines[currentLineIndex];
          nextTextElement.textContent = (currentLineIndex + 1 < textLines.length)
            ? textLines[currentLineIndex + 1]
            : "";
        } else {
          exampleTextElement.textContent = "All done!";
          nextTextElement.textContent = "";
        }
      }
      
      // Update the status display.
      function updateStatus() {
        currentModeElement.textContent = mode.charAt(0).toUpperCase() + mode.slice(1);
        // In Shortcut Mode, freeze dynamic status values.
        if (mode === 'shortcut') {
          gameStatusElement.textContent = gameStarted ? "In Progress" : "Waiting to start";
          return;
        }
        gameStatusElement.textContent = gameStarted ? "In Progress" : "Waiting to start";
        errorCountElement.textContent = errorCount;
        totalTypedElement.textContent = totalTyped;
        if (gameStarted && startTime) {
          const elapsedSeconds = (Date.now() - startTime) / 1000;
          const cpm = elapsedSeconds > 0 ? Math.floor((totalTyped / elapsedSeconds) * 60) : 0;
          speedElement.textContent = cpm;
        } else {
          speedElement.textContent = 0;
        }
        const errorPercent = totalTyped > 0 ? ((errorCount / totalTyped) * 100).toFixed(1) : 0;
        errorPercentElement.textContent = errorPercent;
        if (gameStarted && startTime) {
          const elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
          elapsedTimeElement.textContent = elapsedSeconds;
        }
      }
      
      // Update the elapsed time every second.
      function updateClock() {
        // Stop clock updates in Shortcut Mode.
        if (mode === 'shortcut') return;
        if (gameStarted && startTime) {
          updateStatus();
        }
      }
      
      // Reset game state.
      function resetGame() {
        gameStarted = false;
        startTime = null;
        currentLineIndex = 0;
        currentCharIndex = 0;
        totalTyped = 0;
        errorCount = 0;
        typedTextElement.innerHTML = "";
        updateExampleText();
        updateStatus();
        if (clockInterval) {
          clearInterval(clockInterval);
          clockInterval = null;
        }
      }
      
      // Start the game.
      function startGame() {
        if (!gameStarted) {
          resetGame();
          gameStarted = true;
          startTime = Date.now();
          // Only start clock updates in Raw Mode.
          if (mode === 'raw') {
            clockInterval = setInterval(updateClock, 1000);
          }
          updateStatus();
        }
      }
      
      // Switch between Raw and Shortcut Modes.
      // resetGameFlag: whether to reset game state (default true).
      function switchMode(newMode, resetGameFlag = true) {
        mode = newMode;
        Array.from(modeRadios).forEach(function(radio) {
          radio.checked = (radio.value === newMode);
        });
        if (mode === 'raw') {
          instructionsElement.textContent = 'In Raw Mode, type anywhere to start. Press Escape to switch to Shortcut Mode.';
          // Restart clock updates if the game is in progress.
          if (gameStarted && !clockInterval) {
            clockInterval = setInterval(updateClock, 1000);
          }
        } else if (mode === 'shortcut') {
          instructionsElement.textContent = 'In Shortcut Mode, press Enter to start, S to switch to Raw Mode, and R to reset the game.';
          // Stop status updates and clock.
          if (clockInterval) {
            clearInterval(clockInterval);
            clockInterval = null;
          }
        }
        if (resetGameFlag) {
          resetGame();
        }
        updateStatus();
      }
      
      // Process keystrokes.
      function keyHandler(e) {
        // Prevent space from scrolling.
        if (e.key === " ") {
          e.preventDefault();
        }
        
        // Ignore modifier keys.
        if (e.ctrlKey || e.altKey || e.metaKey) return;
        
        // Handle keys in Shortcut Mode.
        if (mode === 'shortcut') {
          if (e.key.toLowerCase() === "s") {
            switchMode('raw');
            return;
          }
          if (e.key.toLowerCase() === "r") {
            resetGame();
            return;
          }
          if (!gameStarted && e.key === "Enter") {
            startGame();
            return;
          }
          // In Shortcut Mode, ignore all other keys (do not input text).
          return;
        }
        
        // In Raw Mode, auto-start on the first key press.
        if (mode === 'raw' && !gameStarted) {
          startGame();
        }
        
        // Process only single-character keys in Raw Mode.
        if (gameStarted && e.key.length === 1) {
          handleTyping(e.key);
        }
      }
      
      // Process typing input.
      function handleTyping(char) {
        if (!gameStarted || currentLineIndex >= textLines.length) return;
        
        const expectedChar = textLines[currentLineIndex][currentCharIndex];
        if (char === expectedChar) {
          // Correct input: append letter and move on.
          const span = document.createElement('span');
          span.textContent = char;
          span.classList.add('correct');
          typedTextElement.appendChild(span);
          currentCharIndex++;
          totalTyped++;
          // If the entire line is typed, clear the typed text and move to the next line.
          if (currentCharIndex === textLines[currentLineIndex].length) {
            typedTextElement.innerHTML = "";
            currentLineIndex++;
            currentCharIndex = 0;
            updateExampleText();
            // If no more lines, finish the game.
            if (currentLineIndex >= textLines.length) {
              gameStarted = false;
              gameStatusElement.textContent = "Completed!";
              if (clockInterval) {
                clearInterval(clockInterval);
                clockInterval = null;
              }
            }
          }
        } else {
          // Incorrect key: increment error count.
          errorCount++;
        }
        updateStatus();
      }
      
      // Attach event listeners.
      document.addEventListener('keydown', keyHandler);
      Array.from(modeRadios).forEach(function(radio) {
        radio.addEventListener('change', function(e) {
          switchMode(e.target.value);
        });
      });
      
      // Initialize displays.
      updateExampleText();
      updateStatus();
    })();
  </script>
</body>
</html>
